---
layout: post
title: wordpressのブログをJekyll+GitHub pagesに移行。
date: 2015-01-26 23:00:00.000000000 +09:00
categories:
- 日記
tags: []
status: publish
type: post
published: true
meta:
  _title: wordpressのブログをJekyll+GitHub pagesに移行。
  _id: '1519'
  _wpcom_is_markdown: '1'
  _edit_last: '1'
author:
  login: admin
  email: hiroki@hrkd.net
  display_name: admin
  first_name: ''
  last_name: ''
---

もう7,8年は使ってるwordpressには満足していたんだけれども、
最近の運用方法としてはマークダウンの文章をひたすら流しこむだけで、リッチな管理画面は少々 too much、wordpress本体やテーマのメンテナンスもちょっとめんどうだなと思っていました。

<!--more-->

外部のブログサービスも考えたけれど、Jekyll + GitHub pagesのブログシステムは運用方法がとてもシンプルで、かつホスティングとドメインマッピングが無料なので、採用することに。

##移行の方法

###まずはjekyllをインストール
[http://jekyllrb.com/docs/installation/](http://jekyllrb.com/docs/installation/)

うまくインストールが出来ない時にはエラーメッセージをまず読む。ぼくの場合は環境変数に文字コード指定を追加するなどした。


###既存の記事をエクスポート
wordpressの標準機能でxmlファイルをエクスポート。

[http://netaone.com/wp/wordpress-xml-import/#WordPressXML](http://netaone.com/wp/wordpress-xml-import/#WordPressXML)

エクスポートしたxmlファイルはjekyllのインポート機能を使ってインポート。

###インポート
[http://import.jekyllrb.com/docs/installation/](http://import.jekyllrb.com/docs/installation/)

jekyll-importというgemをインストール。具体的なxmlのインポートは

[http://import.jekyllrb.com/docs/wordpressdotcom/](http://import.jekyllrb.com/docs/wordpressdotcom/)

こちらを参考に。ちなみに

```
"no_fetch_images" => false
```
のオプションは、利用している画像などをDLしてくれるものなのだけれども（更に記事内のpathの書き換えもしてくれる）、自分の場合はありがた迷惑だったので値はtrueに。

ハマったのパーマリンク。記事毎のYAML記法の情報とパーマリンクの連携方法がわからなかった。記事内に書いているYAMLの情報が、パーマリンクのURLで利用できない。。。

結局、パーマリンクで利用できる情報はYAMLではなくて、各記事のファイル名から取得されるということがわかった。また、YAMLからすべての情報が拾えるわけではなく、[こちら](http://jekyllrb.com/docs/permalinks/)に記載があるパラメータしか利用することができない。

ということで、ぼくはパーマリンクにwordpressの記事IDを利用したかったので、対処法を調べていたところ[こちらの記事](http://namaraii.com/archives/18406)がヒット。[本家からフォークされたコード](https://github.com/htakeuchi/jekyll-import/blob/master/lib/jekyll/jekyll-import/wordpressdotcom.rb)をDLしてgemをインストールし直す。

```
cd /your/jekyll-import/repos/path/jekyll-import
gem uninstall jekyll-import-0.5.3.gem
gem build jekyll-import.gemspec
sudo gem install jekyll-import-0.5.3.gem
```

これでやっと記事IDをパーマリンクに利用できる。_postディレクトリをまるっと削除した後に、もう一度インポートをし直して、解決。

###ホスティング・ドメインマッピング
GitHubはjekyllのビルドに対応しているので、jekyllのファイル群をまとめてpushすると自動的にビルドをしてくれる。

静的サイトのホスティングの方法と、ドメインマッピングについては、まるっとこちらの記事を参考に。
[http://himaratsu.hatenablog.com/entry/github/hosting](http://himaratsu.hatenablog.com/entry/github/hosting)

GitHub上で作成したリポジトリをcloneして、jekyllのファイル一式をリポジトリ以下に移動、pushすればすぐに見られるようになる。

ただ、（当然ですが）ローカルでエラーが起きていてjekyllが起動しない場合は、GitHubにプッシュした際にもGitHub側はビルドができない。その場合はGitHubからビルドに失敗したとメールが届くので、ローカルできちんと動作するかを再度確認すること。
